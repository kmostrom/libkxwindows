///////////////////////////////////////////////////////////////////////////////////////////////////////

#include <kxWindows/UIListBox.h>
#include <kxWindows/Rect.h>

////////////////////////////////////////////////////////////////////////////////

LRESULT UIListBox::AddFile(LPCTSTR filename)
{
	return ::SendMessage(mWindowHandle, LB_ADDFILE, (WPARAM) 0, (LPARAM) filename);
}

///////////////////////////////////////////////////////////////////////////////////////////////////////

LRESULT UIListBox::AddString(LPCTSTR string)
{
	return ::SendMessage(mWindowHandle, LB_ADDSTRING, (WPARAM) 0, (LPARAM) string);
}

///////////////////////////////////////////////////////////////////////////////////////////////////////

LRESULT UIListBox::DeleteString(int index)
{
	return ::SendMessage(mWindowHandle, LB_DELETESTRING, (WPARAM) index, (LPARAM) 0);
}

///////////////////////////////////////////////////////////////////////////////////////////////////////

LRESULT UIListBox::Dir(UINT attribute, LPCTSTR path)
{
	return ::SendMessage(mWindowHandle, LB_DIR, (WPARAM) attribute, (LPARAM) path);
}

///////////////////////////////////////////////////////////////////////////////////////////////////////

LRESULT UIListBox::FindString(long index, LPCTSTR string)
{
	return ::SendMessage(mWindowHandle, LB_FINDSTRING, (WPARAM) index, (LPARAM) string);
}

///////////////////////////////////////////////////////////////////////////////////////////////////////

LRESULT UIListBox::FindStringExact(long index, LPCSTR string)
{
	return ::SendMessage(mWindowHandle, LB_FINDSTRINGEXACT, (WPARAM) index, (LPARAM) string);
}

///////////////////////////////////////////////////////////////////////////////////////////////////////

LRESULT UIListBox::GetAnchorIndex(void)
{
	return ::SendMessage(mWindowHandle, LB_GETANCHORINDEX, (WPARAM) 0, (LPARAM) 0);
}

///////////////////////////////////////////////////////////////////////////////////////////////////////

LRESULT UIListBox::GetCaretIndex(void)
{
	return ::SendMessage(mWindowHandle, LB_GETCARETINDEX, (WPARAM) 0, (LPARAM) 0);
}

///////////////////////////////////////////////////////////////////////////////////////////////////////

LRESULT UIListBox::GetCount(void)
{
	return ::SendMessage(mWindowHandle, LB_GETCOUNT, (WPARAM) 0, (LPARAM) 0);
}

///////////////////////////////////////////////////////////////////////////////////////////////////////

LRESULT UIListBox::GetCurSel(void)
{
	return ::SendMessage(mWindowHandle, LB_GETCURSEL, (WPARAM) 0, (LPARAM) 0);
}

///////////////////////////////////////////////////////////////////////////////////////////////////////

LRESULT UIListBox::GetHorizontalExtent(void)
{
	return ::SendMessage(mWindowHandle, LB_GETHORIZONTALEXTENT, (WPARAM) 0, (LPARAM) 0);
}

///////////////////////////////////////////////////////////////////////////////////////////////////////

LRESULT UIListBox::GetItemData(long index)
{
	return ::SendMessage(mWindowHandle, LB_GETITEMDATA, (WPARAM) index, (LPARAM) 0);
}

///////////////////////////////////////////////////////////////////////////////////////////////////////

LRESULT UIListBox::GetItemHeight(long index)
{
	return ::SendMessage(mWindowHandle, LB_GETITEMHEIGHT, (WPARAM) index, (LPARAM) 0);
}

///////////////////////////////////////////////////////////////////////////////////////////////////////

LRESULT UIListBox::GetItemRect(long index, LPRECT rect)
{
	return ::SendMessage(mWindowHandle, LB_GETITEMRECT, (WPARAM) index, (LPARAM) rect);
}

///////////////////////////////////////////////////////////////////////////////////////////////////////

LRESULT UIListBox::GetListboxInfo(void)
{
	return ::SendMessage(mWindowHandle, LB_GETLISTBOXINFO, (WPARAM) 0, (LPARAM) 0);
}

///////////////////////////////////////////////////////////////////////////////////////////////////////

LRESULT UIListBox::GetLocale(void)
{
	return ::SendMessage(mWindowHandle, LB_GETLOCALE, (WPARAM) 0, (LPARAM) 0);
}

///////////////////////////////////////////////////////////////////////////////////////////////////////

LRESULT UIListBox::GetSel(long index)
{
	return ::SendMessage(mWindowHandle, LB_GETSEL, (WPARAM) index, (LPARAM) 0);
}

///////////////////////////////////////////////////////////////////////////////////////////////////////

LRESULT UIListBox::GetSelCount(void)
{
	return ::SendMessage(mWindowHandle, LB_GETSELCOUNT, (WPARAM) 0, (LPARAM) 0);
}

///////////////////////////////////////////////////////////////////////////////////////////////////////

LRESULT UIListBox::GetSelItems(long itemCount, LPUINT items)
{
	return ::SendMessage(mWindowHandle, LB_GETSELITEMS, (WPARAM) itemCount, (LPARAM) items);
}

///////////////////////////////////////////////////////////////////////////////////////////////////////

LRESULT UIListBox::GetText(long index, LPCTSTR string)
{
	return ::SendMessage(mWindowHandle, LB_GETTEXT, (WPARAM) index, (LPARAM) string);
}

///////////////////////////////////////////////////////////////////////////////////////////////////////

LRESULT UIListBox::GetTextLen(long index)
{
	return ::SendMessage(mWindowHandle, LB_GETTEXTLEN, (WPARAM) index, (LPARAM) 0);
}

///////////////////////////////////////////////////////////////////////////////////////////////////////

LRESULT UIListBox::GetTopIndex(void)
{
	return ::SendMessage(mWindowHandle, LB_GETTOPINDEX, (WPARAM) 0, (LPARAM) 0);
}

///////////////////////////////////////////////////////////////////////////////////////////////////////

LRESULT UIListBox::InitStorage(long itemCount, long bytes)
{
	return ::SendMessage(mWindowHandle, LB_INITSTORAGE, (WPARAM) itemCount, (LPARAM) bytes);
}

///////////////////////////////////////////////////////////////////////////////////////////////////////

LRESULT UIListBox::InsertString(long index, LPCTSTR string)
{
	return ::SendMessage(mWindowHandle, LB_INSERTSTRING, (WPARAM) index, (LPARAM) string);
}

///////////////////////////////////////////////////////////////////////////////////////////////////////

LRESULT UIListBox::ItemFromPoint(long x, long y)
{
	return ::SendMessage(mWindowHandle, LB_ITEMFROMPOINT, (WPARAM) 0, (LPARAM) MAKELPARAM(x, y));
}

///////////////////////////////////////////////////////////////////////////////////////////////////////

LRESULT UIListBox::ResetContent(void)
{
	return ::SendMessage(mWindowHandle, LB_RESETCONTENT, (WPARAM) 0, (LPARAM) 0);
}

///////////////////////////////////////////////////////////////////////////////////////////////////////

LRESULT UIListBox::SelectString(long index, LPCTSTR string)
{
	return ::SendMessage(mWindowHandle, LB_SELECTSTRING, (WPARAM) index, (LPARAM) string);
}

///////////////////////////////////////////////////////////////////////////////////////////////////////

LRESULT UIListBox::SelItemRange(BOOL select, long startIndex, long endIndex)
{
	return ::SendMessage(mWindowHandle, LB_SELITEMRANGE, (WPARAM) select, (LPARAM) MAKELPARAM(startIndex, endIndex));
}

///////////////////////////////////////////////////////////////////////////////////////////////////////

LRESULT UIListBox::SelItemRangeEx(long startIndex, long endIndex)
{
	return ::SendMessage(mWindowHandle, LB_SELITEMRANGEEX, (WPARAM) startIndex, (LPARAM) endIndex);
}

///////////////////////////////////////////////////////////////////////////////////////////////////////

LRESULT UIListBox::SetAnchorIndex(long index)
{
	return ::SendMessage(mWindowHandle, LB_SETANCHORINDEX, (WPARAM) index, (LPARAM) 0);
}

///////////////////////////////////////////////////////////////////////////////////////////////////////

LRESULT UIListBox::SetCaretIndex(long index, BOOL scroll)
{
	return ::SendMessage(mWindowHandle, LB_SETCARETINDEX, (WPARAM) index, (LPARAM) scroll);
}

///////////////////////////////////////////////////////////////////////////////////////////////////////

LRESULT UIListBox::SetColumnWidth(long width)
{
	return ::SendMessage(mWindowHandle, LB_SETCOLUMNWIDTH, (WPARAM) width, (LPARAM) 0);
}

///////////////////////////////////////////////////////////////////////////////////////////////////////

LRESULT UIListBox::SetCount(long count)
{
	return ::SendMessage(mWindowHandle, LB_SETCOUNT, (WPARAM) count, (LPARAM) 0);
}

///////////////////////////////////////////////////////////////////////////////////////////////////////

LRESULT UIListBox::SetCurSel(long index)
{
	return ::SendMessage(mWindowHandle, LB_SETCURSEL, (WPARAM) index, (LPARAM) 0);
}

///////////////////////////////////////////////////////////////////////////////////////////////////////

LRESULT UIListBox::SetHorizontalExtent(long extent)
{
	return ::SendMessage(mWindowHandle, LB_SETHORIZONTALEXTENT, (WPARAM) extent, (LPARAM) 0);
}

///////////////////////////////////////////////////////////////////////////////////////////////////////

LRESULT UIListBox::SetItemData(long index, long value)
{
	return ::SendMessage(mWindowHandle, LB_SETITEMDATA, (WPARAM) index, (LPARAM) value);
}

///////////////////////////////////////////////////////////////////////////////////////////////////////

LRESULT UIListBox::SetItemHeight(long index, long height)
{
	return ::SendMessage(mWindowHandle, LB_SETITEMHEIGHT, (WPARAM) index, (LPARAM) height);
}

///////////////////////////////////////////////////////////////////////////////////////////////////////

LRESULT UIListBox::SetLocale(WORD locale)
{
	return ::SendMessage(mWindowHandle, LB_SETLOCALE, (WPARAM) locale, (LPARAM) 0);
}

///////////////////////////////////////////////////////////////////////////////////////////////////////

LRESULT UIListBox::SetSel(BOOL select, long index)
{
	return ::SendMessage(mWindowHandle, LB_SETSEL, (WPARAM) select, (LPARAM) index);
}

///////////////////////////////////////////////////////////////////////////////////////////////////////

LRESULT UIListBox::SetTabStops(long tabStopCount, LPUINT tabStops)
{
	return ::SendMessage(mWindowHandle, LB_SETTABSTOPS, (WPARAM) tabStopCount, (LPARAM) tabStops);
}

///////////////////////////////////////////////////////////////////////////////////////////////////////

LRESULT UIListBox::SetTopIndex(long index)
{
	return ::SendMessage(mWindowHandle, LB_SETTOPINDEX, (WPARAM) index, (LPARAM) 0);
}

///////////////////////////////////////////////////////////////////////////////////////////////////////

HWND UIListBox::Create(HWND parentWindowHandle, UINT id)
{
	mParentWindowHandle = parentWindowHandle;

	mWindowHandle = CreateWindowEx(
		WS_EX_CLIENTEDGE,
		WC_LISTBOX,
		"",
		WS_VISIBLE | WS_CHILD | LBS_WANTKEYBOARDINPUT,
		0, 0, 220, 127,
		mParentWindowHandle,
		(HMENU) id,
		GetModuleHandle(NULL),
		this);

	SubClass(UIWindow::stWndProc);
	PostMessage(mWindowHandle, WM_SETFONT, (WPARAM) GetStockObject(ANSI_VAR_FONT), FALSE);

	return mWindowHandle;
}

///////////////////////////////////////////////////////////////////////////////////////////////////////

LRESULT CALLBACK UIListBox::WndProc(HWND windowHandle, UINT message, WPARAM wParam, LPARAM lParam)
{
	return CallWindowProc(mOldWndProc, windowHandle, message, wParam, lParam);
}

///////////////////////////////////////////////////////////////////////////////////////////////////////

std::string UIListBox::GetText(int index)
{
	std::string text;

	int selectionIndex = this->GetCurSel();

	if (selectionIndex != LB_ERR)
	{
		int length = this->GetTextLen(selectionIndex);

		if (length > 0)
		{
			char* buffer = new char[length + 1];

			if (buffer)
			{
				this->GetText(selectionIndex, buffer);
				text = std::string(buffer);

				delete buffer;
			}
		}
	}

	return text;
}

///////////////////////////////////////////////////////////////////////////////////////////////////////

////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

#include <windows.h>
#include <windowsx.h>

#include "ZBitmap.h"

////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

ZBitmap::ZBitmap( DWORD dwImageID )
:	_hbmImage(NULL),
	_hbmImageT(NULL),
	_hdcSrc(NULL)
{
	if( dwImageID )
		LoadBitmap( dwImageID );
	else
		::ZeroMemory( &_bm, sizeof(BITMAP) );
}

////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

ZBitmap::ZBitmap(const TCHAR *pszFileName)
:	_hbmImage(NULL),
	_hbmImageT(NULL),
	_hdcSrc(NULL)
{
	::LoadBitmap( ::GetModuleHandle(NULL), "c:\\aluminum.jpg" );
}

////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

ZBitmap::~ZBitmap(void)
{
	Destroy( );
}

////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

void ZBitmap::LoadBitmap( DWORD dwImageID )
{
	if( _hbmImage )
		Destroy( );

	_hbmImage	= ::LoadBitmap( ::GetModuleHandle(NULL), MAKEINTRESOURCE(dwImageID) );

	_hdcSrc		= ::CreateCompatibleDC( NULL );

	_hbmImageT	= SelectBitmap( _hdcSrc, _hbmImage );

	::GetObject( _hbmImage, sizeof(_bm), &_bm );
}

////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

void ZBitmap::Blit(HDC hDstDC, int iDstX, int iDstY, int iDstWidth, int iDstHeight, int iSrcX, int iSrcY, DWORD dwOp) const
{
	if( !iDstWidth )
		iDstWidth = _bm.bmWidth;

	if( !iDstHeight )
		iDstHeight = _bm.bmHeight;

	if( _hbmImage )
		BitBlt( hDstDC, iDstX, iDstY, iDstWidth, iDstHeight, _hdcSrc, iSrcX, iSrcY, dwOp );
}

////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

void ZBitmap::Blit(HDC hDstDC, LPRECT pDstRect, POINT *pSrcPt, DWORD dwOp) const
{
	POINT	ptTmp = { 0, 0 };
	RECT	rtTmp = { 0, 0, 0, 0 };

	if( !pDstRect )
		pDstRect = &rtTmp;

	if( !pSrcPt )
		pSrcPt = &ptTmp;

	this->Blit( hDstDC, pDstRect->left, pDstRect->top, pDstRect->right, pDstRect->bottom, pSrcPt->x, pSrcPt->y, dwOp );
}

////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

void ZBitmap::Destroy(void)
{
	SelectBitmap( _hdcSrc, _hbmImage );
	::DeleteDC( _hdcSrc );

	if( _hbmImage )
	{
		::DeleteObject( _hbmImage );
		_hbmImage = NULL;
	}

	if( _hbmImageT )
	{
		::DeleteObject( _hbmImageT );
		_hbmImageT = NULL;
	}
}

////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

HDC ZBitmap::GetDC(void) const
{
	return( _hdcSrc );
}

////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

ZBitmap::operator HBITMAP (void)
{
	return( _hbmImage );
}

////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

ZBitmap::operator HDC (void)
{
	return( _hdcSrc );
}

////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

ZBitmap::operator BITMAP& (void)
{
	return( _bm );
}

////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
